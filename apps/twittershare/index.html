<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>Image Uploader</title>
    <script defer type="application/javascript" src="js/activities.js"></script>
    <script defer type="application/javascript" src="js/ext/sha1.js"></script>
    <script defer type="application/javascript" src="js/ext/oauth.js"></script>
    <script defer type="application/javascript" src="js/credentials_db.js"></script>
    <script defer type="application/javascript" src="js/image-uploader.js"></script>
  </head>
  <body role="application">
    <span>
      Message
    </span>
    <div>
      <textarea id="msgInput"></textarea>
    </div>
    <button id="btnSend">Send</button>
    <button id="btnRevoke">Revoke</button>
  </body>
  <script language="javascript">
    var image;
    function dataURItoBlob(dataURI) {
      // convert base64 to raw binary data held in a string
      // doesn't handle URLEncoded DataURIs
      var byteString = atob(dataURI.split(',')[1]);

      // separate out the mime component
      var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0]

      // write the bytes of the string to an ArrayBuffer
      var ab = new ArrayBuffer(byteString.length);
      var ia = new Uint8Array(ab);
      for (var i = 0; i < byteString.length; i++) {
          ia[i] = byteString.charCodeAt(i);
      }

      return new Blob([ab], {'type': mimeString});
    }
    document.addEventListener("onImageReceived", function(e) { 
      //e.data
      var img = document.createElement('img');
      img.style.width = '100px';
      
      img.src = e.detail.data;
      image = dataURItoBlob(img.src);
      console.log('Binary');
      console.log(image);
      
      document.body.appendChild(img);
    });
  </script>
</html>

